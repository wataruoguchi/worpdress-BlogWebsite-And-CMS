!function(){var e=angular.module("app.controllers",["ngResource","textAngular","ngTagsInput","ui.router","cropme","ui.bootstrap","app.filters"]);e.controller("MainController",function(e,t){e.setInfo=function(s,a,r){t.userId=s,t.roleId=r,e.userId=s,e.displayName=a,e.roleId=r},e.getEditUserId=function(){t.editUserId=e.userId}}),e.controller("DashboardController",function(e,t,s){e.dataResEditView=t("./dataRes/dataResDashboard.php",{userId:s.userId},{}),e.oneRecordData=e.dataResEditView.query()}),e.controller("TableController",function(e,t,s,a){a.postId=null,e.results=[],e.filteredResults=[],e.pageSize=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.filteredResults.length/e.pageSize)},e.jumpPage=function(t){e.currentPage=t},e.setActive=function(t){e.filter=t},e.isActive=function(t){return t==e.filter},e.getReSearchResult=function(){e.currentPage=0,e.getSearchResult()},e.getSearchResult=function(){switch(e.filteredResults=s("filter")(e.results,e.searchBox),$filteredResultsPlusButton=[],e.filter){case"all":angular.forEach(e.filteredResults,function(e){"1"!=e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton;break;case"published":angular.forEach(e.filteredResults,function(e){"1"==e.isPublishedFlag&&"1"!=e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton;break;case"draft":angular.forEach(e.filteredResults,function(e){"1"!=e.isPublishedFlag&&"1"!=e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton;break;case"delete":angular.forEach(e.filteredResults,function(e){"1"==e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton}},e.$watch("searchBox",function(){e.currentPage=0,e.getSearchResult()}),e.autoPaging=function(){e.currentPage*e.pageSize+1>e.filteredResults.length&&(e.currentPage-=1,e.jumpPage(e.currentPage))},e.dataResPostList=t("./dataRes/dataResPostList.php",{userId:a.userId},{}),e.results=e.dataResPostList.query(function(){e.filter="all",e.getSearchResult()}),e.add=function(){a.postId=null},e.trash=function(t){var s=new e.dataResPostList;s.postId=e.filteredResults[t].postId,e.filteredResults[t].$delete(s),e.filteredResults[t].isDeletedFlag="1",e.getSearchResult(),e.autoPaging()},e.delete=function(t){var s=new e.dataResPostList;s.postId=e.filteredResults[t].postId,e.filteredResults[t].$delete(s);var a=0,r=!1;angular.forEach(e.results,function(l){r||l.postId==s.postId&&(e.filteredResults.splice(t,1),e.results.splice(a,1),r=!0),a++}),e.autoPaging()}}),e.controller("RecordController",function(e,t,s){$tagsOnListRes=t("./dataRes/dataResEditViewTags.php",{postId:e.result.postId,userId:s.userId},{}),e.tagsOnList=$tagsOnListRes.query(function(){e.result.tags=e.tagsOnList}),e.autoPaging=function(){e.currentPage*e.pageSize+1>e.filteredResults.length&&(e.currentPage-=1,e.jumpPage(e.currentPage))},e.update=function(){s.postId=e.result.postId},e.updateViaComment=function(){s.postId=e.result.rootId},e.changeToApprove=function(){e.result.isApprovedFlag="1",e.dataResCommentsList=t("./dataRes/dataResCommentsList.php",{postId:e.result.postId,apF:e.result.isApprovedFlag,spF:e.result.isSpamFlag},{update:{method:"PUT"}}),e.dataResCommentsList.update(),e.getSearchResult(),e.autoPaging()},e.changeToSpam=function(){e.result.isSpamFlag="1",e.dataResCommentsList=t("./dataRes/dataResCommentsList.php",{postId:e.result.postId,apF:e.result.isApprovedFlag,spF:e.result.isSpamFlag},{update:{method:"PUT"}}),e.dataResCommentsList.update(),e.getSearchResult(),e.autoPaging()}}),e.controller("EditPageController",function(e,t,s,a){e.postId=s.postId,e.saveDraft=function(){e.oneRecordData[0].isPublishedFlag="0",e.oneRecordData[0].isDeletedFlag="0",e.update()},e.publish=function(){e.oneRecordData[0].isPublishedFlag="1",e.oneRecordData[0].isDeletedFlag="0",e.update()},e.dataResEditView=t("./dataRes/dataResEditView.php",{postId:s.postId,userId:s.userId},{update:{method:"PUT"}}),e.oneRecordData=e.dataResEditView.query(function(){e.postId=e.oneRecordData[0].postId,s.postId=e.postId}),e.update=function(){s.postId=e.postId,e.oneRecordData[0].$update(function(){e.updateTags()})},e.trash=function(){var t=new e.dataResEditView;t.postId=e.oneRecordData[0].postId,e.oneRecordData[0].$delete(t,function(){s.postId=null,a.go("page2")})},e.tags=[],e.storedTags=[],e.addTag=function(t){isOnList=!1,angular.forEach(e.tags,function(e){return e.text==t?(isOnList=!0,void 0):void 0}),isOnList||e.tags.push({text:t})},getDataResEditViewTagsResource=function(){return t("./dataRes/dataResEditViewTags.php",{postId:s.postId,userId:s.userId},{saveData:{method:"POST",isArray:!0}})},e.dataResEditViewTags=getDataResEditViewTagsResource(),e.tags=e.dataResEditViewTags.query(),e.updateTags=function(){$updateDataResource=getDataResEditViewTagsResource(),$updateDataResource.saveData({},e.tags,function(){s.postId=null,a.go("page2")})},e.dataResEditViewGetTagMaster=t("./dataRes/dataResEditViewGetTagMaster.php",{userId:s.userId},{}),e.storedTags=e.dataResEditViewGetTagMaster.query(),e.$on("cropme:done",function(e,t,a){var r=t.croppedImage,l=new XMLHttpRequest;l.upload&&r.type==a&&(l.onreadystatechange=function(){4==this.readyState&&200==this.status?console.log("done"):4==this.readyState&&200!==this.status&&console.log("error")},l.open("POST","./dataRes/dataResEditViewPostImage.php",!0),l.setRequestHeader("X-FILENAME",r.name),l.setRequestHeader("POSTID",s.postId),l.send(r))})}),e.controller("CommentsTableController",function(e,t,s,a){a.postId=null,e.results=[],e.filteredResults=[],e.pageSize=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.filteredResults.length/e.pageSize)},e.jumpPage=function(t){e.currentPage=t},e.setActive=function(t){e.filter=t},e.isActive=function(t){return t==e.filter},e.getCommentSearchResult=function(){e.getSearchResult(),e.currentPage=0},e.getSearchResult=function(){e.filteredResults=s("filter")(e.results,e.searchBox),$filteredResultsPlusButton=[],"pending"==e.filter?(angular.forEach(e.filteredResults,function(e){"1"!=e.isApprovedFlag&&"1"!=e.isSpamFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton):"approved"==e.filter?(angular.forEach(e.filteredResults,function(e){"1"==e.isApprovedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton):"spam"==e.filter&&(angular.forEach(e.filteredResults,function(e){"1"==e.isSpamFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton)},e.$watch("searchBox",function(){e.currentPage=0,e.getSearchResult()}),e.dataResCommentsList=t("./dataRes/dataResCommentsList.php",{userId:a.userId},{update:{method:"PUT"}}),e.results=e.dataResCommentsList.query(function(){e.filter="pending",e.getSearchResult()})}),e.controller("UsersTableController",function(e,t,s,a,r){return e.results=[],e.filteredResults=[],e.pageSize=10,e.currentPage=0,e.currentUserId=a.userId,"1"!=a.roleId?(r.go("page1"),void 0):(e.numberOfPages=function(){return Math.ceil(e.filteredResults.length/e.pageSize)},e.jumpPage=function(t){e.currentPage=t},e.setActive=function(t){e.filter=t},e.isActive=function(t){return t==e.filter},e.getCommentSearchResult=function(){e.getSearchResult(),e.currentPage=0},e.getSearchResult=function(){e.filteredResults=s("filter")(e.results,e.searchBox),$filteredResultsPlusButton=[],"all"==e.filter?(angular.forEach(e.filteredResults,function(e){"1"!=e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton):"admin"==e.filter?(angular.forEach(e.filteredResults,function(e){"1"!=e.isDeletedFlag&&"1"==e.roleId&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton):"general"==e.filter?(angular.forEach(e.filteredResults,function(e){"1"!=e.isDeletedFlag&&"2"==e.roleId&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton):"deleted"==e.filter&&(angular.forEach(e.filteredResults,function(e){"1"==e.isDeletedFlag&&$filteredResultsPlusButton.push(e)}),e.filteredResults=$filteredResultsPlusButton)},e.$watch("searchBox",function(){e.getSearchResult()}),e.autoPaging=function(){e.currentPage*e.pageSize+1>e.filteredResults.length&&(e.currentPage-=1,e.jumpPage(e.currentPage))},e.getEditUserId=function(t){a.editUserId=e.filteredResults[t].userId},e.dataResUsersList=t("./dataRes/dataResUsersList.php",{userId:a.userId},{}),e.results=e.dataResUsersList.query(function(){e.filter="all",e.getSearchResult()}),e.add=function(){a.editUserId=null},e.trash=function(t){var s=new e.dataResUsersList;s.userId=e.filteredResults[t].userId,e.filteredResults[t].$delete(s),e.filteredResults[t].isDeletedFlag="1",e.getSearchResult(),e.autoPaging()},void 0)}),e.controller("profilePageController",function(e,t,s,a){return angular.isUndefined(s.editUserId)?(a.go("page1"),void 0):(e.roleIsDisabled=function(){return"1"!=s.roleId?!0:s.userId==s.editUserId?!0:void 0},e.availabilityIsDisabled=function(){return"1"!=s.roleId?!0:s.userId==s.editUserId?!0:void 0},e.userAvailabilityOptions=[{label:"Available",value:"0"},{label:"Unavailable",value:"1"}],e.dataResEditUser=t("./dataRes/dataResEditUser.php",{userId:s.editUserId},{update:{method:"PUT"}}),e.oneRecordUserData=e.dataResEditUser.query(function(){s.editUserId=e.oneRecordUserData[0].userId,e.initUserAvailability=function(){e.oneRecordUserData[0].userAvailabilitySelected="1"==e.oneRecordUserData[0].isDeletedFlag?e.userAvailabilityOptions[1]:e.userAvailabilityOptions[0]},e.initUserAvailability(),e.dataResEditUserGetUserroleMaster=t("./dataRes/dataResEditUserGetUserroleMaster.php",{},{}),e.userRoleOptions=e.dataResEditUserGetUserroleMaster.query(function(){var t=0;angular.forEach(e.userRoleOptions,function(s){s.value==e.oneRecordUserData[0].RoleId&&(e.oneRecordUserData[0].userRoleSelected=e.userRoleOptions[t]),t++})}),e.oneRecordUserData[0].currentPassword=null,e.oneRecordUserData[0].newPassword=null,e.oneRecordUserData[0].newPassword2=null}),e.saveProfile=function(){null!=e.oneRecordUserData[0].Email&&null!=s.editUserId&&(e.dataResEditUserGetUserMaster=t("./dataRes/dataResEditUserGetUserMaster.php",{userId:s.editUserId,email:e.oneRecordUserData[0].Email},{}),e.existEmail=e.dataResEditUserGetUserMaster.query(function(){if(0!=e.existEmail.length)return console.log("email address is used"),void 0;if(null!=e.oneRecordUserData[0].password){if(null!=e.oneRecordUserData[0].currentPassword||null!=e.oneRecordUserData[0].newPassword||null!=e.oneRecordUserData[0].newPassword2){if(e.oneRecordUserData[0].currentPassword!=e.oneRecordUserData[0].password)return console.log("current password error"),void 0;if(e.oneRecordUserData[0].newPassword!=e.oneRecordUserData[0].newPassword2)return console.log("repeat password error"),void 0;e.oneRecordUserData[0].password=e.oneRecordUserData[0].newPassword}}else if(null==e.oneRecordUserData[0].password){if(null==e.oneRecordUserData[0].newPassword&&null==e.oneRecordUserData[0].newPassword2)return console.log("no password error"),void 0;if(e.oneRecordUserData[0].newPassword!=e.oneRecordUserData[0].newPassword2)return console.log("repeat password error(new)"),void 0;e.oneRecordUserData[0].password=e.oneRecordUserData[0].newPassword}e.oneRecordUserData[0].userId=s.editUserId,e.oneRecordUserData[0].isDeletedFlag=e.oneRecordUserData[0].userAvailabilitySelected.value,e.oneRecordUserData[0].RoleId=e.oneRecordUserData[0].userRoleSelected.value,e.oneRecordUserData[0].$update(function(){s.userId==s.editUserId?a.go("page1"):a.go("page4")})}))},void 0)}),e.controller("contactsPageController",function(e,t,s){e.results=[],e.filteredResults=[],e.pageSize=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.filteredResults.length/e.pageSize)},e.jumpPage=function(t){e.currentPage=t},e.getCommentSearchResult=function(){e.getSearchResult(),e.currentPage=0},e.getSearchResult=function(){e.filteredResults=s("filter")(e.results,e.searchBox)},e.$watch("searchBox",function(){e.getSearchResult()}),e.dataResContacts=t("./dataRes/dataResContacts.php"),e.results=e.dataResContacts.query(function(){e.getSearchResult()})}),e.controller("tagsPageController",function(e,t,s,a){e.results=[],e.filteredResults=[],e.pageSize=10,e.currentPage=0,e.numberOfPages=function(){return Math.ceil(e.filteredResults.length/e.pageSize)},e.jumpPage=function(t){e.currentPage=t},e.addToggleVal=!1,e.addToggle=function(){e.addToggleVal=!e.addToggleVal},e.addTagName="",e.addDescription="",e.bindNewTagNameManually=function(t){e.addTagName=t},e.bindNewTagDescManually=function(t){e.addDescription=t},e.add=function(){dataResTags=t("./dataRes/dataResTags.php",{tagName:e.addTagName,description:e.addDescription,userId:a.userId},{update:{method:"PUT"}}),dataResTags.save(function(){e.results=dataResTags.query(function(){e.getSearchResult(),e.addTagName="",e.addDescription="",e.addToggleVal=!1})})},e.update=function(s){dataResTags=t("./dataRes/dataResTags.php",{tagId:e.filteredResults[s].tagId,tagName:e.filteredResults[s].tagName,description:e.filteredResults[s].description},{update:{method:"PUT"}}),dataResTags.update()},e.delete=function(t){var s=new e.dataResTags;s.tagId=e.filteredResults[t].tagId,e.dataResTags.delete(s);var a=0,r=!1;angular.forEach(e.results,function(l){r||l.tagId==s.tagId&&(e.filteredResults.splice(t,1),e.results.splice(a,1),r=!0),a++}),e.autoPaging()},e.autoPaging=function(){e.currentPage*e.pageSize+1>e.filteredResults.length&&(e.currentPage-=1,e.jumpPage(e.currentPage))},e.getCommentSearchResult=function(){e.getSearchResult(),e.currentPage=0},e.getSearchResult=function(){e.filteredResults=s("filter")(e.results,e.searchBox)},e.$watch("searchBox",function(){e.getSearchResult()}),e.dataResTags=t("./dataRes/dataResTags.php",{userId:a.userId}),e.results=e.dataResTags.query(function(){e.getSearchResult()})})}();